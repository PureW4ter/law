define(["component/nav_bar","component/header","ajaxhelper","utility"],function(e,t,n,r){var i={initialize:function(){e.initialize("i_navbar",1),t.initialize("i_header","用户订单"),this.mainBox1=$("#i_mainbox1"),this.tplFun1=_.template($("#i_tpl1").html()),this.mainBox2=$("#i_mainbox2"),this.tplFun2=_.template($("#i_tpl2").html()),this.modalBox=$("#i_modal_body"),this.modalTplFun=_.template($("#i_modal_tpl").html()),this._sendRequest()},_sendRequest:function(){if(r.getQueryParameter("uid")){var e={page:0,size:20,userId:r.getQueryParameter("uid")};n.get("http://"+window.frontJSHost+"/api/order/ilistbyuser",e,this,this._render1,null),n.get("http://"+window.frontJSHost+"/api/order/slistbyuser",e,this,this._render2,null)}else{var e={page:0,size:20,lawyerId:r.getQueryParameter("lid"),status:r.getQueryParameter("status")};n.get("http://"+window.frontJSHost+"/api/order/ilistbylawyer",e,this,this._render1,null),n.get("http://"+window.frontJSHost+"/api/order/slistbylawyer",e,this,this._render2,null)}},_render1:function(e){this.mainBox1.html(this.tplFun1({result:e})),this._registEvent()},_render2:function(e){this.mainBox2.html(this.tplFun2({result:e})),this._registEvent()},_registEvent:function(){$(".j_assign").off("click",this._assign).on("click",{ctx:this},this._assign),$(".j_do_assign").off("click",this._doAssign).on("click",{ctx:this},this._doAssign)},_assign:function(e){var t={cityId:$(e.currentTarget).data("city")},r=$(e.currentTarget).parents("tr").data("id");n.get("http://"+window.frontJSHost+"/api/lawyer/listbycity",t,e.data.ctx,function(e){$("#i_modal").data({id:r}).modal("show"),this.modalBox.html(this.modalTplFun({result:e})),this._registEvent()},null)},_doAssign:function(e){var t=$("#i_modal").data("id"),i=$(e.currentTarget).parents("tr").data("id"),s={opId:r.getUserId(),lawyerId:i,orderId:t};$("#i_modal").modal("hide"),n.get("http://"+window.frontJSHost+"/api/order/assignment",s,e.data.ctx,function(e){r.showToast("指派成功"),this._sendRequest()},null)}};return i});