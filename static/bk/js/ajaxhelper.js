define(["utility"],function(e){var t={local:"LOCAL",showLoading:!0,get:function(e,t,n,r,i){this._send("GET",e,t,n,r,i)},post:function(e,t,n,r,i,s){this._send("POST",e,t,n,r,i)},put:function(e,t,n,r,i){this._send("PUT",e,t,n,r,i)},"delete":function(e,t,n,r,i){this._send("DELETE",e,t,n,r,i)},_send:function(t,n,r,i,s,o){if(window.localStorage.DEBUG===this.local){this._loadJSONData(n,i,s);return}var u=this;u._showLoading(),$.ajax({type:t,url:n,data:r,dataType:"json",timeout:6e5,async:!0,contentType:"application/x-www-form-urlencoded; charset=utf-8",beforeSend:function(e,t){},success:function(e){u._hideLoading(),s&&Object.prototype.toString.call(s)==="[object Function]"&&s.apply(i,[e])},error:function(t,n){u._hideLoading(),e.showToast("服务器出错，类型："+n),o&&Object.prototype.toString.call(o)==="[object Function]"&&o.apply(i,[t,n])}})},_showLoading:function(){this.showLoading&&e.showLoading()},_hideLoading:function(){this.showLoading&&e.hideLoading()},loadError:function(e){},_loadJSONData:function(e,t,n){var r=e.substr(e.lastIndexOf("/")+1);r.indexOf("?")>0&&(r=r.substr(0,r.indexOf("?"))),r="data/"+r+".json";var i="test_data_"+(new Date).getTime();$("body").append('<script type="text/javascript">testDataKey="'+i+'"</script>'),$("body").append('<script src="'+r+'" type="text/javascript"></script>'),setTimeout(function(){n.apply(t,[window[i]])},10)}};return t});