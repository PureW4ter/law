define(["utility"],function(e){var t={local:"LOCAL",get:function(e,t,n,r,i,s,o){this._send("GET",e,t,n,r,i,s,o)},post:function(e,t,n,r,i,s,o){this._send("POST",e,t,n,r,i,s,o)},put:function(e,t,n,r,i,s,o){this._send("PUT",e,t,n,r,i,s,o)},"delete":function(e,t,n,r,i,s,o){this._send("DELETE",e,t,n,r,i,s,o)},_send:function(t,n,r,i,s,o,u,a){if(window.localStorage.DEBUG===this.local){this._loadJSONData(n,i,s);return}a==undefined&&(a=!0);var f="application/x-www-form-urlencoded; charset=utf-8";if(t==="POST"||t==="PUT")f="application/json;",r=JSON.stringify(r);var l=this;l.isPaging=u,u||this._showLoading(),$.ajax({type:t,url:n,data:r,dataType:"json",timeout:6e5,async:a,contentType:f,beforeSend:function(e,t){},success:function(t){l._hideLoading(),t&&t.s==200||!t||!t.s?s&&Object.prototype.toString.call(s)==="[object Function]"&&s.apply(i,[t]):e.showToast("服务器出错，类型："+t.s)},error:function(t,n){l._hideLoading(),e.showToast("服务器出错，类型："+n),o&&Object.prototype.toString.call(o)==="[object Function]"&&o.apply(i,[t,n])}})},_showLoading:function(){e.showLoading()},_hideLoading:function(){e.hideLoading()},loadError:function(e){},_loadJSONData:function(e,t,n){var r=e.substr(e.lastIndexOf("/")+1);r.indexOf("?")>0&&(r=r.substr(0,r.indexOf("?"))),r="data/"+r+".json";var i="test_data_"+(new Date).getTime();$("body").append('<script type="text/javascript">testDataKey="'+i+'"</script>'),$("body").append('<script src="'+r+'" type="text/javascript"></script>'),setTimeout(function(){n.apply(t,[window[i]])},10)}};return t});