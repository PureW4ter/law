/*! xhEditor v1.2.2 | (c) 2009, 2013 xheditor.com.
Licence: http://xheditor.com/license/lgpl.txt */

!function(){var e={};window.XHEDITOR=e}(),function(e,t){e.mapLang={},e.setLang=function(n,r){r===t&&(r=n,n=""),""!==n&&(n+=".");var i,s;for(var o in r)s=r[o],i=n+o,"string"==typeof s||s instanceof Array?e.mapLang[i]=s:e.setLang(i,s)},e.getLang=function(n){var r=e.mapLang[n];if(r===t&&(r=n.replace(/{#([^{}]+)}/g,function(t,n){var r=e.mapLang[n];return r?r:n})),"string"==typeof r){var i=arguments;r=r.replace(/{\$(\d+)}/g,function(e,n){var r=i[parseInt(n,10)+1];return r!==t?r:e})}return r}}(XHEDITOR),function(e,t){function n(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}}if(!e.browser){var r=n(navigator.userAgent),i={};r.browser&&(i[r.browser]=!0,i.version=r.version),i.chrome?i.webkit=!0:i.webkit&&(i.safari=!0),e.browser=i}}(jQuery),function(XHEDITOR,$,undefined){var agent=navigator.userAgent.toLowerCase(),bMobile=/mobile/i.test(agent),browser=$.browser,browerVer=parseFloat(browser.version),isIE=browser.msie,isIE11=/trident\//i.test(agent)&&(/rv:/i.test(agent)||/Netscape/i.test(agent.appName)),isMozilla=browser.mozilla,isWebkit=browser.webkit,isOpera=browser.opera,isChrome=browser.chrome,bAir=agent.indexOf(" adobeair/")>-1,xCount=0,bShowPanel=!1,bClickCancel=!0,bShowModal=!1,bCheckEscInit=!1,_jPanel,_jShadow,_jCntLine,_jPanelButton,jModal,jModalShadow,layerShadow,jOverlay,jHideSelect,onModalRemove,editorRoot,getLang=XHEDITOR.getLang;if($("script[src*=xheditor]").each(function(){var e=this.src;return e.match(/xheditor[^\/]*\.js/i)?(editorRoot=e.replace(/[\?#].*$/,"").replace(/(^|[\/\\])[^\/]*$/,"$1"),!1):void 0}),isIE){try{document.execCommand("BackgroundImageCache",!1,!0)}catch(e){}var jqueryVer=$.fn.jquery;jqueryVer&&jqueryVer.match(/^1\.[67]/)&&($.attrHooks.width=$.attrHooks.height=null)}var specialKeys={27:"esc",9:"tab",32:"space",13:"enter",8:"backspace",145:"scroll",20:"capslock",144:"numlock",19:"pause",45:"insert",36:"home",46:"del",35:"end",33:"pageup",34:"pagedown",37:"left",38:"up",39:"right",40:"down",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12"},arrAlign=[{v:"justifyleft"},{v:"justifycenter"},{v:"justifyright"},{v:"justifyfull"}],arrList=[{v:"insertOrderedList"},{v:"insertUnorderedList"}],htmlPastetext='<div><label for="xhePastetextValue">{#PastetextTip}</label></div><div><textarea id="xhePastetextValue" wrap="soft" spellcheck="false" style="width:300px;height:100px;" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="{#dialogOk}" /></div>',htmlLink='<div><label for="xheLinkUrl">{#link.url}</label><input type="text" id="xheLinkUrl" value="http://" class="xheText" /></div><div><label for="xheLinkTarget">{#link.target}</label><select id="xheLinkTarget"><option selected="selected" value="">{#default}</option><option value="_blank">{#link.targetBlank}</option><option value="_self">{#link.targetSelf}</option><option value="_parent">{#link.targetParent}</option></select></div><div style="display:none"><label for="xheLinkText">{#link.linkText}</label><input type="text" id="xheLinkText" value="" class="xheText" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="{#dialogOk}" /></div>',htmlAnchor='<div><label for="xheAnchorName">{#anchor.name}</label><input type="text" id="xheAnchorName" value="" class="xheText" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="{#dialogOk}" /></div>',htmlImg='<div><label for="xheImgUrl">{#img.url}</label><input type="text" id="xheImgUrl" value="http://" class="xheText" /></div><div><div><label for="xheImgAlt">{#img.alt}</label><input type="text" id="xheImgAlt" /></div><div><label for="xheImgAlign">{#img.align}</label><select id="xheImgAlign"><option selected="selected" value="">{#default}</option><option value="left">{#img.alignLeft}</option><option value="right">{#img.alignRight}</option><option value="top">{#img.alignTop}</option><option value="middle">{#img.alignMiddle}</option><option value="baseline">{#img.alignBaseline}</option><option value="bottom">{#img.alignBottom}</option></select></div><div><label for="xheImgWidth">{#img.width}</label><input type="text" id="xheImgWidth" style="width:40px;" /> <label for="xheImgHeight">{#img.height}</label><input type="text" id="xheImgHeight" style="width:40px;" /></div><div><label for="xheImgBorder">{#img.border}</label><input type="text" id="xheImgBorder" style="width:40px;" /></div><div><label for="xheImgHspace">{#img.hspace}</label><input type="text" id="xheImgHspace" style="width:40px;" /> <label for="xheImgVspace">{#img.vspace}</label><input type="text" id="xheImgVspace" style="width:40px;" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="{#dialogOk}" /></div>',htmlFlash='<div><label for="xheFlashUrl">{#flash.url}</label><input type="text" id="xheFlashUrl" value="http://" class="xheText" /></div><div><label for="xheFlashWidth">{#flash.width}</label><input type="text" id="xheFlashWidth" style="width:40px;" value="480" /> <label for="xheFlashHeight">{#flash.height}</label><input type="text" id="xheFlashHeight" style="width:40px;" value="400" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="{#dialogOk}" /></div>',htmlMedia='<div><label for="xheMediaUrl">{#media.url}</label><input type="text" id="xheMediaUrl" value="http://" class="xheText" /></div><div><label for="xheMediaWidth">{#media.width}</label><input type="text" id="xheMediaWidth" style="width:40px;" value="480" /> <label for="xheMediaHeight">{#media.height}</label><input type="text" id="xheMediaHeight" style="width:40px;" value="400" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="{#dialogOk}" /></div>',htmlTable='<div><label for="xheTableRows">{#table.rows}</label><input type="text" id="xheTableRows" style="width:40px;" value="3" /> <label for="xheTableColumns">{#table.columns}</label><input type="text" id="xheTableColumns" style="width:40px;" value="2" /></div><div><label for="xheTableHeaders">{#table.headers}</label><select id="xheTableHeaders"><option selected="selected" value="">{#none}</option><option value="row">{#table.headersRow}</option><option value="col">{#table.headersCol}</option><option value="both">{#table.headersBoth}</option></select></div><div><label for="xheTableWidth">{#table.width}</label><input type="text" id="xheTableWidth" style="width:40px;" value="200" /> <label for="xheTableHeight">{#table.height}</label><input type="text" id="xheTableHeight" style="width:40px;" value="" /></div><div><label for="xheTableBorder">{#table.border}</label><input type="text" id="xheTableBorder" style="width:40px;" value="1" /></div><div><label for="xheTableCellSpacing">{#table.cellSpacing}</label><input type="text" id="xheTableCellSpacing" style="width:40px;" value="1" /> <label for="xheTableCellPadding">{#table.cellPadding}</label><input type="text" id="xheTableCellPadding" style="width:40px;" value="1" /></div><div><label for="xheTableAlign">{#table.align}</label><select id="xheTableAlign"><option selected="selected" value="">{#default}</option><option value="left">{#table.alignLeft}</option><option value="center">{#table.alignCenter}</option><option value="right">{#table.alignRight}</option></select></div><div><label for="xheTableCaption">{#table.caption}</label><input type="text" id="xheTableCaption" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="{#dialogOk}" /></div>',htmlAbout='<div style="font:12px Arial;width:245px;word-wrap:break-word;word-break:break-all;outline:none;" role="dialog" tabindex="-1"><p><span style="font-size:20px;color:#1997DF;">xhEditor</span><br />v1.2.2 (build 150426)</p><p>{#aboutXheditor}</p><p>Copyright &copy; <a href="http://xheditor.com/" target="_blank">xhEditor.com</a>. All rights reserved.</p></div>',itemEmots={"default":{name:"{#default}",width:24,height:24,line:7,list:["smile","tongue","titter","laugh","sad","wronged","fastcry","cry","wail","mad","knock","curse","crazy","angry","ohmy","awkward","panic","shy","cute","envy","proud","struggle","quiet","shutup","doubt","despise","sleep","bye"]}},arrTools={Cut:{t:"Cut"},Copy:{t:"Copy"},Paste:{t:"Paste"},Pastetext:{t:"Pastetext",h:isIE?0:1},Blocktag:{t:"Blocktag",h:1},Fontface:{t:"Fontface",h:1},FontSize:{t:"FontSize",h:1},Bold:{t:"Bold",s:"Ctrl+B"},Italic:{t:"Italic",s:"Ctrl+I"},Underline:{t:"Underline",s:"Ctrl+U"},Strikethrough:{t:"Strikethrough"},FontColor:{t:"FontColor",h:1},BackColor:{t:"BackColor",h:1},SelectAll:{t:"SelectAll"},Removeformat:{t:"Removeformat"},Align:{t:"Align",h:1},List:{t:"List",h:1},Outdent:{t:"Outdent"},Indent:{t:"Indent"},Link:{t:"Link",s:"Ctrl+L",h:1},Unlink:{t:"Unlink"},Anchor:{t:"Anchor",h:1},Img:{t:"Img",h:1},Flash:{t:"Flash",h:1},Media:{t:"Media",h:1},Hr:{t:"Hr"},Emot:{t:"Emot",s:"ctrl+e",h:1},Table:{t:"Table",h:1},Source:{t:"Source"},Preview:{t:"Preview"},Print:{t:"Print",s:"Ctrl+P"},Fullscreen:{t:"Fullscreen",s:"Esc"},About:{t:"About"}},toolsThemes={mini:"Bold,Italic,Underline,Strikethrough,|,Align,List,|,Link,Img",simple:"Blocktag,Fontface,FontSize,Bold,Italic,Underline,Strikethrough,FontColor,BackColor,|,Align,List,Outdent,Indent,|,Link,Img,Emot",full:"Cut,Copy,Paste,Pastetext,|,Blocktag,Fontface,FontSize,Bold,Italic,Underline,Strikethrough,FontColor,BackColor,SelectAll,Removeformat,|,Align,List,Outdent,Indent,|,Link,Unlink,Anchor,Img,Flash,Media,Hr,Emot,Table,|,Source,Preview,Print,Fullscreen"};toolsThemes.mfull=toolsThemes.full.replace(/\|(,Align)/i,"/$1");var arrDbClick={a:"Link",img:"Img",embed:"Embed"},uploadInputname="filedata",arrEntities={"<":"&lt;",">":"&gt;",'"':"&quot;","®":"&reg;","©":"&copy;"},regEntities=/[<>"®©]/g,Xheditor=function(textarea,options){function checkDblClick(e){var t=e.target,n=arrDbClick[t.tagName.toLowerCase()];if(n){if("Embed"===n){var r={"application/x-shockwave-flash":"Flash","application/x-mplayer2":"Media"};n=r[t.type.toLowerCase()]}_this.exec(n)}}function checkEsc(e){return 27===e.which?(bShowModal?_this.removeModal():bShowPanel&&_this.hidePanel(),!1):void 0}function loadReset(){setTimeout(_this.setSource,10)}function saveResult(){_this.getSource()}function cleanPaste(e){var t,n,r;if(e&&(t=e.originalEvent.clipboardData)&&(n=t.items)&&(r=n[0])&&"file"==r.kind&&r.type.match(/^image\//i)){var i=r.getAsFile(),s=new FileReader;return s.onload=function(){var e='<img src="'+event.target.result+'">';e=replaceRemoteImg(e),_this.pasteHTML(e)},s.readAsDataURL(i),!1}var o=settings.cleanPaste;if(0===o||bSource||bCleanPaste)return!0;bCleanPaste=!0,_this.saveBookmark();var u=isIE?"pre":"div",a=$("<"+u+' class="xhe-paste">﻿﻿</'+u+">",_doc).appendTo(_doc.body),f=a[0],l=_this.getSel(),c=_this.getRng(!0);a.css("top",_jWin.scrollTop()),isIE||isIE11?(c.moveToElementText(f),c.select()):(c.selectNodeContents(f),l.removeAllRanges(),l.addRange(c)),setTimeout(function(){var e,t=3===o;if(t)a.html(a.html().replace(/<br(\s+[^<>]*)?>/gi,"\n")),e=a.text();else{var n=$(".xhe-paste",_doc.body),r=[];n.each(function(e,t){0==$(t).find(".xhe-paste").length&&r.push(t.innerHTML)}),e=r.join("<br />")}a.remove(),_this.loadBookmark(),e=e.replace(/^[\s\uFEFF]+|[\s\uFEFF]+$/g,""),e&&(t?_this.pasteText(e):(e=_this.cleanHTML(e),e=_this.cleanWord(e),e=_this.formatXHTML(e),(!settings.onPaste||settings.onPaste&&(e=settings.onPaste(e))!==!1)&&(e=replaceRemoteImg(e),_this.pasteHTML(e)))),bCleanPaste=!1},0)}function replaceRemoteImg(e){var t=settings.localUrlTest,n=settings.remoteImgSaveUrl;if(t&&n){var r=[],i=0;e=e.replace(/(<img)((?:\s+[^>]*?)?(?:\s+src="\s*([^"]+)\s*")(?: [^>]*)?)(\/?>)/gi,function(e,n,s,o,u){return!/^(https?|data:image)/i.test(o)||/_xhe_temp/.test(s)||t.test(o)||(r[i]=o,s=s.replace(/\s+(width|height)="[^"]*"/gi,"").replace(/\s+src="[^"]*"/gi,' src="'+skinPath+'img/waiting.gif" remoteimg="'+i++ +'"')),n+s+u}),r.length>0&&$.post(n,{urls:r.join("|")},function(e){e=e.split("|"),$("img[remoteimg]",_this.doc).each(function(){var t=$(this);xheAttr(t,"src",e[t.attr("remoteimg")]),t.removeAttr("remoteimg")})})}return e}function setCSS(e){try{_this._exec("styleWithCSS",e,!0)}catch(t){try{_this._exec("useCSS",!e,!0)}catch(t){}}}function setOpts(){if(bInit&&!bSource){setCSS(!1);try{_this._exec("enableObjectResizing",!0,!0)}catch(e){}if(isIE)try{_this._exec("BackgroundImageCache",!0,!0)}catch(e){}}}function forcePtag(e){if(bSource||13!==e.which||e.shiftKey||e.ctrlKey||e.altKey)return!0;var t=_this.getParent("p,h1,h2,h3,h4,h5,h6,pre,address,div,li");return t.is("li")?!0:settings.forcePtag?void (0===t.length&&_this._exec("formatblock","<p>")):(_this.pasteHTML("<br />"),isIE&&t.length>0&&2===_this.getRng().parentElement().childNodes.length&&_this.pasteHTML("<br />"),!1)}function fixFullHeight(){isMozilla||isWebkit||(bFullscreen&&_jArea.height("100%").css("height",_jArea.outerHeight()-_jTools.outerHeight()),isIE&&_jTools.hide().show())}function fixAppleSel(e){if(e=e.target,e.tagName.match(/(img|embed)/i)){var t=_this.getSel(),n=_this.getRng(!0);n.selectNode(e),t.removeAllRanges(),t.addRange(n)}}function xheAttr(e,t,n){if(!t)return!1;var r="_xhe_"+t;return n&&(urlType&&(n=getLocalUrl(n,urlType,urlBase)),e.attr(t,urlBase?getLocalUrl(n,"abs",urlBase):n).removeAttr(r).attr(r,n)),e.attr(r)||e.attr(t)}function clickCancelPanel(){bClickCancel&&_this.hidePanel()}function checkShortcuts(e){if(bSource)return!0;var t=e.which,n=specialKeys[t],r=n?n:String.fromCharCode(t).toLowerCase();sKey="",sKey+=e.ctrlKey?"ctrl+":"",sKey+=e.altKey?"alt+":"",sKey+=e.shiftKey?"shift+":"",sKey+=r;var i,s=arrShortCuts[sKey];for(i in s){if(i=s[i],!$.isFunction(i))return _this.exec(i),!1;if(i.call(_this)===!1)return!1}}function is(e,t){var n=typeof e;return t?"array"===t&&e.hasOwnProperty&&e instanceof Array?!0:n===t:"undefined"!=n}function getLocalUrl(e,t,n){if(e.match(/^(\w+):\/\//i)&&!e.match(/^https?:/i)||/^#/i.test(e)||/^data:/i.test(e))return e;var r=n?$('<a href="'+n+'" />')[0]:location,i=r.protocol,s=r.host,o=r.hostname,u=r.port,a=r.pathname.replace(/\\/g,"/").replace(/[^\/]+$/i,"");if(""===u&&(u="80"),""===a?a="/":"/"!==a.charAt(0)&&(a="/"+a),e=$.trim(e),"abs"!==t&&(e=e.replace(new RegExp(i+"\\/\\/"+o.replace(/\./g,"\\.")+"(?::"+u+")"+("80"===u?"?":"")+"(/|$)","i"),"/")),"rel"===t&&(e=e.replace(new RegExp("^"+a.replace(/([\/\.\+\[\]\(\)])/g,"\\$1"),"i"),"")),"rel"!==t&&(e.match(/^(https?:\/\/|\/)/i)||(e=a+e),"/"===e.charAt(0))){var f,l,c=[],h=e.split("/"),p=h.length;for(l=0;p>l;l++)f=h[l],".."===f?c.pop():""!==f&&"."!==f&&c.push(f);""===h[p-1]&&c.push(""),e="/"+c.join("/")}return"abs"!==t||e.match(/^https?:\/\//i)||(e=i+"//"+s+e),e=e.replace(/(https?:\/\/[^:\/?#]+):80(\/|$)/i,"$1$2")}function checkFileExt(e,t){return"*"===t||e.match(new RegExp(".("+t.replace(/,/g,"|")+")$","i"))?!0:(alert(getLang("upload.extLimit",t)),!1)}function formatBytes(e){var t=["Byte","KB","MB","GB","TB","PB"],n=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,Math.floor(n))).toFixed(2)+t[n]}function returnFalse(){return!1}var _this=this,_text=textarea,_jText=$(_text),_jForm=_jText.closest("form"),_jTools,_jArea,_win,_jWin,_doc,_jDoc,bookmark,bInit=!1,bSource=!1,bFullscreen=!1,bCleanPaste=!1,outerScroll,bShowBlocktag=!1,sLayoutStyle="",ev=null,timer,bDisableHoverExec=!1,bQuickHoverExec=!1,lastPoint=null,lastAngle=null,editorHeight=0,settings=_this.settings=$.extend({},XHEDITOR.settings,options),plugins=settings.plugins,strPlugins=[];if(plugins&&(arrTools=$.extend({},arrTools,plugins),$.each(plugins,function(e){strPlugins.push(e)}),strPlugins=strPlugins.join(",")),settings.tools.match(/^\s*(m?full|simple|mini)\s*$/i)){var toolsTheme=toolsThemes[$.trim(settings.tools)];settings.tools=settings.tools.match(/m?full/i)&&plugins?toolsTheme.replace("Table","Table,"+strPlugins):toolsTheme}settings.tools.match(/(^|,)\s*About\s*(,|$)/i)||(settings.tools+=",About"),settings.tools=settings.tools.split(","),settings.editorRoot&&(editorRoot=settings.editorRoot),bAir===!1&&(editorRoot=getLocalUrl(editorRoot,"abs")),settings.urlBase&&(settings.urlBase=getLocalUrl(settings.urlBase,"abs"));var idCSS="xheCSS_"+settings.skin,idContainer="xhe"+xCount+"_container",idTools="xhe"+xCount+"_Tool",idIframeArea="xhe"+xCount+"_iframearea",idIframe="xhe"+xCount+"_iframe",idFixFFCursor="xhe"+xCount+"_fixffcursor",headHTML="",bodyClass="",skinPath=editorRoot+"xheditor_skin/"+settings.skin+"/",arrEmots=itemEmots,urlType=settings.urlType,urlBase=settings.urlBase,emotPath=settings.emotPath,emotPath=emotPath?emotPath:editorRoot+"xheditor_emot/",selEmotGroup="";arrEmots=$.extend({},arrEmots,settings.emots),emotPath=getLocalUrl(emotPath,"rel",urlBase?urlBase:null),bShowBlocktag=settings.showBlocktag,bShowBlocktag&&(bodyClass+=" showBlocktag");var arrShortCuts=[];this.init=function(){function e(e){var t,n=$(e.target);(t=n.css("width"))&&n.css("width","").attr("width",t.replace(/[^0-9%]+/g,"")),(t=n.css("height"))&&n.css("height","").attr("height",t.replace(/[^0-9%]+/g,""))}0===$("#"+idCSS).length&&$("head").append('<link id="'+idCSS+'" rel="stylesheet" type="text/css" href="'+skinPath+'ui.css" />');var t=_jText.outerWidth(),n=_jText.outerHeight(),r=settings.width||_text.style.width||(t>10?t:0);editorHeight=settings.height||_text.style.height||(n>10?n:150),/^\d+(?:\.\d+)?$/.test(r)&&(r+="px"),is(editorHeight,"string")&&(editorHeight=editorHeight.replace(/[^\d]+/g,""));var i,s,o=settings.background||_text.style.background,u=['<span class="xheGStart"/>'],a=/\||\//i;$.each(settings.tools,function(e,t){if(t.match(a)&&u.push('<span class="xheGEnd"/>'),"|"===t)u.push('<span class="xheSeparator"/>');else if("/"===t)u.push("<br />");else{if(i=arrTools[t],!i)return;s=i.c?i.c:"xheIcon xheBtn"+t,u.push('<span><a href="#" title="{#'+i.t+'}" cmd="'+t+'" class="xheButton xheEnabled" tabindex="-1" role="button"><span class="'+s+'" unselectable="on" style="font-size:0;color:transparent;text-indent:-999px;">'+i.t+"</span></a></span>"),i.s&&_this.addShortcuts(i.s,t)}t.match(a)&&u.push('<span class="xheGStart"/>')}),u.push('<span class="xheGEnd"/><br />'),_jText.after($('<input type="text" id="'+idFixFFCursor+'" style="position:absolute;display:none;" /><span id="'+idContainer+'" class="xhe_'+settings.skin+'" style="display:none"><table cellspacing="0" cellpadding="0" class="xheLayout" style="'+("0px"!=r?"width:"+r+";":"")+"height:"+editorHeight+'px;" role="presentation"><tr><td id="'+idTools+'" class="xheTool" unselectable="on" style="height:1px;" role="presentation"></td></tr><tr><td id="'+idIframeArea+'" class="xheIframeArea" role="presentation"><iframe frameborder="0" id="'+idIframe+'" src="javascript:;" style="width:100%;"></iframe></td></tr></table></span>')),_jTools=$("#"+idTools),_jArea=$("#"+idIframeArea),headHTML='<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><link rel="stylesheet" href="'+skinPath+'iframe.css"/>';var f=settings.loadCSS;if(f)if(is(f,"array"))for(var l in f)headHTML+='<link rel="stylesheet" href="'+f[l]+'"/>';else headHTML+=f.match(/\s*<style(\s+[^>]*?)?>[\s\S]+?<\/style>\s*/i)?f:'<link rel="stylesheet" href="'+f+'"/>';var c='<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head>'+headHTML+"<title>{#defaultReadTip} "+(settings.readTip?settings.readTip:"")+"</title>";o&&(c+="<style>html{background:"+o+";}</style>"),c+='</head><body spellcheck="0" class="editMode'+bodyClass+'"></body></html>',_this.win=_win=$("#"+idIframe)[0].contentWindow,_jWin=$(_win);try{this.doc=_doc=_win.document,_jDoc=$(_doc),_doc.open(),_doc.write(getLang(c)),_doc.close(),isIE?_doc.body.contentEditable="true":_doc.designMode="On"}catch(h){}setTimeout(setOpts,300),_this.setSource(),_win.setInterval=null,_jTools.append(getLang(u.join(""))).bind("mousedown contextmenu",returnFalse).click(function(e){var t=$(e.target).closest("a");return t.is(".xheEnabled")&&(clearTimeout(timer),_jTools.find("a").attr("tabindex","-1"),ev=e,_this.exec(t.attr("cmd"))),!1}),_jTools.find(".xheButton").hover(function(e){var t=$(this),n=settings.hoverExecDelay,r=lastAngle;if(lastAngle=null,-1===n||bDisableHoverExec||!t.is(".xheEnabled"))return!1;if(r&&r>10)return bDisableHoverExec=!0,setTimeout(function(){bDisableHoverExec=!1},100),!1;var i=t.attr("cmd"),s=1===arrTools[i].h;return s?(bQuickHoverExec&&(n=0),void (n>=0&&(timer=setTimeout(function(){ev=e,lastPoint={x:ev.clientX,y:ev.clientY},_this.exec(i)},n)))):(_this.hidePanel(),!1)},function(e){lastPoint=null,timer&&clearTimeout(timer)}).mousemove(function(e){if(lastPoint){var t={x:e.clientX-lastPoint.x,y:e.clientY-lastPoint.y};if(Math.abs(t.x)>1||Math.abs(t.y)>1){if(t.x>0&&t.y>0){var n=Math.round(Math.atan(t.y/t.x)/.017453293);lastAngle=lastAngle?(lastAngle+n)/2:n}else lastAngle=null;lastPoint={x:e.clientX,y:e.clientY}}}}),_jPanel=$("#xhePanel"),_jShadow=$("#xheShadow"),_jCntLine=$("#xheCntLine"),0===_jPanel.length&&(_jPanel=$('<div id="xhePanel"></div>').mousedown(function(e){e.stopPropagation()}),_jShadow=$('<div id="xheShadow"></div>'),_jCntLine=$('<div id="xheCntLine"></div>'),setTimeout(function(){$(document.body).append(_jPanel).append(_jShadow).append(_jCntLine)},10)),$("#"+idContainer).show(),_jText.hide(),_jArea.css("height",editorHeight-_jTools.outerHeight()),isIE&8>browerVer&&setTimeout(function(){_jArea.css("height",editorHeight-_jTools.outerHeight())},1),_jText.focus(_this.focus),_jForm.submit(saveResult).bind("reset",loadReset),settings.submitID&&$("#"+settings.submitID).mousedown(saveResult),$(window).bind("unload beforeunload",saveResult).bind("resize",fixFullHeight),$(document).mousedown(clickCancelPanel),bCheckEscInit||($(document).keydown(checkEsc),bCheckEscInit=!0),_jWin.focus(function(){settings.focus&&settings.focus()}).blur(function(){settings.blur&&settings.blur()}),isWebkit&&_jWin.click(fixAppleSel),_jDoc.mousedown(clickCancelPanel).keydown(checkShortcuts).keypress(forcePtag).dblclick(checkDblClick).bind("mousedown click",function(e){_jText.trigger(e.type)}),isIE&&(_jDoc.keydown(function(e){var t=_this.getRng();return 8===e.which&&t.item?($(t.item(0)).remove(),!1):void 0}),_jDoc.bind("controlselect",function(t){t=t.target,$.nodeName(t,"IMG")&&$(t).unbind("resizeend",e).bind("resizeend",e)})),_jDoc.keydown(function(e){var t=e.which;return e.altKey&&t>=49&&57>=t?(_jTools.find("a").attr("tabindex","0"),_jTools.find(".xheGStart").eq(t-49).next().find("a").focus(),_doc.title="﻿﻿",!1):void 0}).click(function(){_jTools.find("a").attr("tabindex","-1")}),_jTools.keydown(function(e){var t=e.which;if(27==t)_jTools.find("a").attr("tabindex","-1"),_this.focus();else if(e.altKey&&t>=49&&57>=t)return _jTools.find(".xheGStart").eq(t-49).next().find("a").focus(),!1});var p=$(_doc.documentElement);isOpera?p.bind("keydown",function(e){e.ctrlKey&&86===e.which&&cleanPaste()}):p.bind(isIE?"beforepaste":"paste",cleanPaste),settings.disableContextmenu&&p.bind("contextmenu",returnFalse),settings.html5Upload&&p.bind("dragenter dragover",function(e){var t;return(t=e.originalEvent.dataTransfer.types)&&-1!==$.inArray("Files",t)?!1:void 0}).bind("drop",function(e){function t(e){var t,n,r;for(i=0;i<e.length;i++){if(n=e[i].name.replace(/.+\./,""),!(t=o.match(new RegExp("(\\w+):[^:]*,"+n+"(?:,|$)","i"))))return 1;if(r){if(r!==t[1])return 2}else r=t[1]}return r}var n,r=e.originalEvent.dataTransfer;if(r&&(n=r.files)&&n.length>0){var i,s,o,u=["Link","Img","Flash","Media"],a=[];for(i in u)s=u[i],settings["up"+s+"Url"]&&settings["up"+s+"Url"].match(/^[^!].*/i)&&a.push(s+":,"+settings["up"+s+"Ext"]);return 0===a.length?!1:(o=a.join(","),s=t(n),1===s?alert(getLang("upload.extLimit",o.replace(/\w+:,/g,""))):2===s?alert(getLang("upload.typeLimit")):s&&_this.startUpload(n,settings["up"+s+"Url"],"*",function(e){var t,n=[],r=settings.onUpload;r&&r(e);for(var i=0,o=e.length;o>i;i++)t=e[i],url=is(t,"string")?t:t.url,"!"===url.substr(0,1)&&(url=url.substr(1)),n.push(url);_this.exec(s),$("#xhe"+s+"Url").val(n.join(" ")),$("#xheSave").click()}),!1)}});var d=settings.shortcuts;d&&$.each(d,function(e,t){_this.addShortcuts(e,t)}),xCount++,bInit=!0,settings.fullscreen?_this.toggleFullscreen():settings.sourceMode&&setTimeout(_this.toggleSource,20);var v=settings.plugins;return v&&$.each(v,function(e,t){var n=t.i;n!==undefined&&n(_this)}),!0},this.remove=function(){_this.hidePanel(),saveResult(),_jText.unbind("focus",_this.focus),_jForm.unbind("submit",saveResult).unbind("reset",loadReset),settings.submitID&&$("#"+settings.submitID).unbind("mousedown",saveResult),$(window).unbind("unload beforeunload",saveResult).unbind("resize",fixFullHeight),$(document).unbind("mousedown",clickCancelPanel),$("#"+idContainer).remove(),$("#"+idFixFFCursor).remove(),_jText.show(),bInit=!1},this.saveBookmark=function(){if(!bSource){_this.focus();var e=_this.getRng();e=e.cloneRange?e.cloneRange():e,bookmark={top:_jWin.scrollTop(),rng:e}}},this.loadBookmark=function(){if(!bSource&&bookmark){_this.focus();var e=bookmark.rng;if(isIE)e.select();else{var t=_this.getSel();t.removeAllRanges(),t.addRange(e)}_jWin.scrollTop(bookmark.top),bookmark=null}},this.focus=function(){if(bSource?$("#sourceCode",_doc).focus():_win.focus(),isIE){var e=_this.getRng();e.parentElement&&e.parentElement().ownerDocument!==_doc&&_this.setTextCursor()}return!1},this.setTextCursor=function(e){var t=_this.getRng(!0),n=_doc.body;if(isIE||isIE11)t.moveToElementText(n);else{for(var r=e?"lastChild":"firstChild";3!=n.nodeType&&n[r];)n=n[r];t.selectNode(n)}if(t.collapse(e?!1:!0),isIE||isIE11)t.select();else{var i=_this.getSel();i.removeAllRanges(),i.addRange(t)}},this.getSel=function(){return _doc.selection?_doc.selection:_win.getSelection()},this.getRng=function(e){var t,n;try{e||(t=_this.getSel(),n=t.createRange?t.createRange():t.rangeCount>0?t.getRangeAt(0):null),n||(n=_doc.body.createTextRange?_doc.body.createTextRange():_doc.createRange())}catch(r){}return n},this.getParent=function(e){var t,n=_this.getRng();return isIE?t=n.item?n.item(0):n.parentElement():(t=n.commonAncestorContainer,n.collapsed||n.startContainer===n.endContainer&&n.startOffset-n.endOffset<2&&n.startContainer.hasChildNodes()&&(t=n.startContainer.childNodes[n.startOffset])),e=e?e:"*",t=$(t),t.is(e)||(t=$(t).closest(e)),t},this.getSelect=function(e){var t=_this.getSel(),n=_this.getRng(),r=!0;if(r=!n||n.item?!1:!t||0===n.boundingWidth||n.collapsed,"text"===e)return r?"":n.text||(t.toString?t.toString():"");var i;if(n.cloneContents){var s,o=$("<div></div>");s=n.cloneContents(),s&&o.append(s),i=o.html()}else i=is(n.item)?n.item(0).outerHTML:is(n.htmlText)?n.htmlText:n.toString();return r&&(i=""),i=_this.processHTML(i,"read"),i=_this.cleanHTML(i),i=_this.formatXHTML(i)},this.pasteHTML=function(e,t){if(bSource)return!1;_this.focus(),e=_this.processHTML(e,"write");var n=_this.getSel(),r=_this.getRng();if(t!==undefined){if(r.item){var i=r.item(0);r=_this.getRng(!0),r.moveToElementText(i),r.select()}r.collapse(t)}if(e+="<"+(isIE?"img":"span")+' id="_xhe_temp" width="0" height="0" />',r.insertNode){if($(r.startContainer).closest("style,script").length>0)return!1;r.deleteContents(),r.insertNode(r.createContextualFragment(e))}else"control"===n.type.toLowerCase()&&(n.clear(),r=_this.getRng()),r.pasteHTML(e);var s=$("#_xhe_temp",_doc),o=s[0];isIE?(r.moveToElementText(o),r.select()):(r.selectNode(o),n.removeAllRanges(),n.addRange(r)),s.remove()},this.pasteText=function(e,t){e||(e=""),e=_this.domEncode(e),e=e.replace(/\r?\n/g,"<br />"),_this.pasteHTML(e,t)},this.appendHTML=function(e){return bSource?!1:(_this.focus(),e=_this.processHTML(e,"write"),$(_doc.body).append(e),void _this.setTextCursor(!0))},this.domEncode=function(e){return e.replace(regEntities,function(e){return arrEntities[e]})},this.setSource=function(e){bookmark=null,"string"!=typeof e&&""!==e&&(e=_text.value),bSource?$("#sourceCode",_doc).val(e):(settings.beforeSetSource&&(e=settings.beforeSetSource(e)),e=_this.cleanHTML(e),e=_this.formatXHTML(e),e=_this.processHTML(e,"write"),isIE?(_doc.body.innerHTML='<img id="_xhe_temp" width="0" height="0" />'+e,$("#_xhe_temp",_doc).remove()):_doc.body.innerHTML=e)},this.processHTML=function(e,t){function n(e,t,n,r,i,o){var u,a,l,c,h="";if(u=r.match(/font-family\s*:\s*([^;"]+)/i),u&&(h+=' face="'+u[1]+'"'),a=r.match(/font-size\s*:\s*([^;"]+)/i)){a=a[1].toLowerCase();for(var p=0;p<s.length;p++)if(a===s[p].n||a===s[p].s){l=p+1;break}l&&(h+=' size="'+l+'"',r=r.replace(/(^|;)(\s*font-size\s*:\s*[^;"]+;?)+/gi,"$1"))}if(c=r.match(/(?:^|[\s;])color\s*:\s*([^;"]+)/i)){var d;if(d=c[1].match(/\s*rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/i)){c[1]="#";for(var v=1;3>=v;v++)c[1]+=("0"+(d[v]-0).toString(16)).slice(-2)}c[1]=c[1].replace(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i,"#$1$1$2$2$3$3"),h+=' color="'+c[1]+'"'}return r=r.replace(/(^|;)(\s*(font-family|color)\s*:\s*[^;"]+;?)+/gi,"$1"),""!==h?(r&&(h+=' style="'+r+'"'),"<font"+(n?n:"")+h+(i?i:"")+">"+o+"</font>"):e}function r(e,t,n,r,i){for(var s,u,a=(n?n:"")+(r?r:""),f=[],l=[],c=0;c<o.length;c++)s=o[c].r,u=o[c].t,a=a.replace(s,function(){return f.push("<"+u+">"),l.push("</"+u+">"),""});return a=a.replace(/\s+style\s*=\s*"\s*"/i,""),(a?"<span"+a+">":"")+f.join("")+i+l.join("")+(a?"</span>":"")}var i=' class="Apple-style-span"',s=settings.listFontsize;if("write"===t)e=e.replace(/(<(\/?)(\w+))((?:\s+[\w\-:]+\s*=\s*(?:"[^"]*"|'[^']*'|[^>\s]+))*)\s*((\/?)>)/g,function(e,t,n,r,s,o,u){r=r.toLowerCase(),isMozilla?"strong"===r?r="b":"em"===r&&(r="i"):isWebkit&&("strong"===r?(r="span",n||(s+=i+' style="font-weight: bold;"')):"em"===r?(r="span",n||(s+=i+' style="font-style: italic;"')):"u"===r?(r="span",n||(s+=i+' style="text-decoration: underline;"')):"strike"===r&&(r="span",n||(s+=i+' style="text-decoration: line-through;"')));var a,f="";if("del"===r)r="strike";else if("img"===r)s=s.replace(/\s+emot\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/i,function(e,t){return a=t.match(/^(["']?)(.*)\1/)[2],a=a.split(","),a[1]||(a[1]=a[0],a[0]=""),"default"===a[0]&&(a[0]=""),settings.emotMark?e:""});else if("a"===r)!s.match(/ href=[^ ]/i)&&s.match(/ name=[^ ]/i)&&(f+=" xhe-anchor"),u&&(o="></a>");else if("table"===r&&!n){var l=s.match(/\s+border\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/i);(!l||l[1].match(/^(["']?)\s*0\s*\1$/))&&(f+=" xhe-border")}var c;if(s=s.replace(/\s+([\w\-:]+)\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/g,function(e,t,n){return t=t.toLowerCase(),n=n.match(/^(["']?)(.*)\1/)[2],aft="",isIE&&t.match(/^(disabled|checked|readonly|selected)$/)&&n.match(/^(false|0)$/i)?"":"img"===r&&a&&"src"===t?"":(t.match(/^(src|href)$/)&&(aft=" _xhe_"+t+'="'+n+'"',urlBase&&(n=getLocalUrl(n,"abs",urlBase))),f&&"class"===t&&(n+=" "+f,f=""),isWebkit&&"style"===t&&"span"===r&&n.match(/(^|;)\s*(font-family|font-size|color|background-color)\s*:\s*[^;]+\s*(;|$)/i)&&(c=!0)," "+t+'="'+n+'"'+aft)}),a){var h=emotPath+(a[0]?a[0]:"default")+"/"+a[1]+".gif";s+=' src="'+h+'" _xhe_src="'+h+'"'}return c&&(s+=i),f&&(s+=' class="'+f+'"'),"<"+n+r+s+o}),isIE&&(e=e.replace(/&apos;/gi,"&#39;")),isWebkit||(e=e.replace(/<(span)(\s+[^>]*?)?\s+style\s*=\s*"((?:[^"]*?;)?\s*(?:font-family|font-size|color)\s*:[^"]*)"( [^>]*)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/gi,n),e=e.replace(/<(span)(\s+[^>]*?)?\s+style\s*=\s*"((?:[^"]*?;)?\s*(?:font-family|font-size|color)\s*:[^"]*)"( [^>]*)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?)<\/\1>/gi,n),e=e.replace(/<(span)(\s+[^>]*?)?\s+style\s*=\s*"((?:[^"]*?;)?\s*(?:font-family|font-size|color)\s*:[^"]*)"( [^>]*)?>(((?!<\1(\s+[^>]*?)?>)[\s\S])*?)<\/\1>/gi,n)),e=e.replace(/<(td|th)(\s+[^>]*?)?>(\s|&nbsp;)*<\/\1>/gi,"<$1$2>"+(isIE?"":"<br />")+"</$1>");else{if(isWebkit)for(var o=[{r:/font-weight\s*:\s*bold;?/gi,t:"strong"},{r:/font-style\s*:\s*italic;?/gi,t:"em"},{r:/text-decoration\s*:\s*underline;?/gi,t:"u"},{r:/text-decoration\s*:\s*line-through;?/gi,t:"strike"}],u=0;2>u;u++)e=e.replace(/<(span)(\s+[^>]*?)?\s+class\s*=\s*"Apple-style-span"(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/gi,r),e=e.replace(/<(span)(\s+[^>]*?)?\s+class\s*=\s*"Apple-style-span"(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?)<\/\1>/gi,r),e=e.replace(/<(span)(\s+[^>]*?)?\s+class\s*=\s*"Apple-style-span"(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S])*?)<\/\1>/gi,r);e=e.replace(/(<(\w+))((?:\s+[\w\-:]+\s*=\s*(?:"[^"]*"|'[^']*'|[^>\s]+))*)\s*(\/?>)/g,function(e,t,n,r,i){n=n.toLowerCase();var o;return r=r.replace(/\s+_xhe_(?:src|href)\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/i,function(e,t){return o=t.match(/^(["']?)(.*)\1/)[2],""}),o&&urlType&&(o=getLocalUrl(o,urlType,urlBase)),r=r.replace(/\s+([\w\-:]+)\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/g,function(e,t,n){if(t=t.toLowerCase(),n=n.match(/^(["']?)(.*)\1/)[2].replace(/"/g,"'"),"class"===t){if(n.match(/^["']?(apple|webkit)/i))return"";if(n=n.replace(/\s?xhe-[a-z]+/gi,""),""===n)return""}else{if(t.match(/^((_xhe_|_moz_|_webkit_)|jquery\d+)/i))return"";if(o&&t.match(/^(src|href)$/i))return" "+t+'="'+o+'"';"style"===t&&(n=n.replace(/(^|;)\s*(font-size)\s*:\s*([a-z-]+)\s*(;|$)/i,function(e,t,n,r,i){for(var o,u,a=0;a<s.length;a++)if(o=s[a],r===o.n){u=o.s;break}return t+n+":"+u+i}))}return" "+t+'="'+n+'"'}),"img"!==n||r.match(/\s+alt\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/i)||(r+=' alt=""'),t+r+i}),e=e.replace(/(<(td|th)(?:\s+[^>]*?)?>)\s*([\s\S]*?)(<br(\s*\/)?>)?\s*<\/\2>/gi,function(e,t,n,r){return t+(r?r:"&nbsp;")+"</"+n+">"}),e=e.replace(/^\s*(?:<(p|div)(?:\s+[^>]*?)?>)?\s*(<span(?:\s+[^>]*?)?>\s*<\/span>|<br(?:\s+[^>]*?)?>|&nbsp;)*\s*(?:<\/\1>)?\s*$/i,"")}return e=e.replace(/(<pre(?:\s+[^>]*?)?>)([\s\S]+?)(<\/pre>)/gi,function(e,t,n,r){return t+n.replace(/<br\s*\/?>/gi,"\r\n")+r})},this.getSource=function(e){var t,n=settings.beforeGetSource;return bSource?(t=$("#sourceCode",_doc).val(),n||(t=_this.formatXHTML(t,!1))):(t=_this.processHTML(_doc.body.innerHTML,"read"),t=_this.cleanHTML(t),t=_this.formatXHTML(t,e),n&&(t=n(t))),_text.value=t,t},this.cleanWord=function(e){function t(e,t,n){return n}var n=settings.cleanPaste;if(n>0&&3>n&&/mso(-|normal)|WordDocument|<table\s+[^>]*?x:str|\s+class\s*=\s*"?xl[67]\d"/i.test(e)){e=e.replace(/<!--[\s\S]*?-->|<!(--)?\[[\s\S]+?\](--)?>|<style(\s+[^>]*?)?>[\s\S]*?<\/style>/gi,""),e=e.replace(/\r?\n/gi,""),isIE?(e=e.replace(/<v:shapetype(\s+[^>]*)?>[\s\S]*<\/v:shapetype>/gi,""),e=e.replace(/<v:shape(\s+[^>]+)?>[\s\S]*?<v:imagedata(\s+[^>]+)?>\s*<\/v:imagedata>[\s\S]*?<\/v:shape>/gi,function(e,t,n){var r;if(r=n.match(/\s+src\s*=\s*("[^"]+"|'[^']+'|[^>\s]+)/i)){r=r[1].match(/^(["']?)(.*)\1/)[2];var i='<img src="'+editorRoot+'xheditor_skin/blank.gif" _xhe_temp="true" class="wordImage"';return r=t.match(/\s+style\s*=\s*("[^"]+"|'[^']+'|[^>\s]+)/i),r&&(r=r[1].match(/^(["']?)(.*)\1/)[2],i+=' style="'+r+'"'),i+=" />"}return""})):e=e.replace(/<img( [^<>]*(v:shapes|msohtmlclip)[^<>]*)\/?>/gi,function(e,t){var n,r='<img src="'+editorRoot+'xheditor_skin/blank.gif" _xhe_temp="true" class="wordImage"';return n=t.match(/ width\s*=\s*"([^"]+)"/i),n&&(r+=' width="'+n[1]+'"'),n=t.match(/ height\s*=\s*"([^"]+)"/i),n&&(r+=' height="'+n[1]+'"'),r+" />"}),e=e.replace(/(<(\/?)([\w\-:]+))((?:\s+[\w\-:]+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^>\s]+))?)*)\s*(\/?>)/g,function(e,t,r,i,s,o){return i=i.toLowerCase(),i.match(/^(link)$/)&&s.match(/file:\/\//i)||i.match(/:/)||"span"===i&&2===n?"":(r||(s=s.replace(/\s([\w\-:]+)(?:\s*=\s*("[^"]*"|'[^']*'|[^>\s]+))?/gi,function(e,t,r){if(t=t.toLowerCase(),/:/.test(t))return"";if(r=r.match(/^(["']?)(.*)\1/)[2],1===n)switch(i){case"p":if("style"===t)return r=r.replace(/"|&quot;/gi,"'").replace(/\s*([^:]+)\s*:\s*(.*?)(;|$)/gi,function(e,t,n){return/^(text-align)$/i.test(t)?t+":"+n+";":""}).replace(/^\s+|\s+$/g,""),r?" "+t+'="'+r+'"':"";break;case"span":if("style"===t)return r=r.replace(/"|&quot;/gi,"'").replace(/\s*([^:]+)\s*:\s*(.*?)(;|$)/gi,function(e,t,n){return/^(color|background|font-size|font-family)$/i.test(t)?t+":"+n+";":""}).replace(/^\s+|\s+$/g,""),r?" "+t+'="'+r+'"':"";break;case"table":if(t.match(/^(cellspacing|cellpadding|border|width)$/i))return e;break;case"td":if(t.match(/^(rowspan|colspan)$/i))return e;if("style"===t)return r=r.replace(/"|&quot;/gi,"'").replace(/\s*([^:]+)\s*:\s*(.*?)(;|$)/gi,function(e,t,n){return/^(width|height)$/i.test(t)?t+":"+n+";":""}).replace(/^\s+|\s+$/g,""),r?" "+t+'="'+r+'"':"";break;case"a":if(t.match(/^(href)$/i))return e;break;case"font":case"img":return e}else if(2===n)switch(i){case"td":if(t.match(/^(rowspan|colspan)$/i))return e;break;case"img":return e}return""})),t+s+o)});for(var r=0;3>r;r++)e=e.replace(/<([^\s>]+)(\s+[^>]*)?>\s*<\/\1>/g,"");for(var r=0;3>r;r++)e=e.replace(/<(span|a)>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/gi,t);for(var r=0;3>r;r++)e=e.replace(/<(span|a)>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?)<\/\1>/gi,t);for(var r=0;3>r;r++)e=e.replace(/<(span|a)>(((?!<\1(\s+[^>]*?)?>)[\s\S])*?)<\/\1>/gi,t);for(var r=0;3>r;r++)e=e.replace(/<font(\s+[^>]+)><font(\s+[^>]+)>/gi,function(e,t,n){return"<font"+t+n+">"});e=e.replace(/(<(\/?)(tr|td)(?:\s+[^>]+)?>)[^<>]+/gi,function(e,t,n,r){return!n&&/^td$/i.test(r)?e:t})}return e},this.cleanHTML=function(e){e=e.replace(/<!?\/?(DOCTYPE|html|body|meta)(\s+[^>]*?)?>/gi,"");var t;return e=e.replace(/<head(?:\s+[^>]*?)?>([\s\S]*?)<\/head>/i,function(e,n){return t=n.match(/<(script|style)(\s+[^>]*?)?>[\s\S]*?<\/\1>/gi),""}),t&&(e=t.join("")+e),e=e.replace(/<\??xml(:\w+)?(\s+[^>]*?)?>([\s\S]*?<\/xml>)?/gi,""),settings.internalScript||(e=e.replace(/<script(\s+[^>]*?)?>[\s\S]*?<\/script>/gi,"")),settings.internalStyle||(e=e.replace(/<style(\s+[^>]*?)?>[\s\S]*?<\/style>/gi,"")),settings.linkTag&&settings.inlineScript&&settings.inlineStyle||(e=e.replace(/(<(\w+))((?:\s+[\w-]+\s*=\s*(?:"[^"]*"|'[^']*'|[^>\s]+))*)\s*(\/?>)/gi,function(e,t,n,r,i){return settings.linkTag||"link"!==n.toLowerCase()?(settings.inlineScript||(r=r.replace(/\s+on(?:click|dblclick|mouse(down|up|move|over|out|enter|leave|wheel)|key(down|press|up)|change|select|submit|reset|blur|focus|load|unload)\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/gi,"")),settings.inlineStyle||(r=r.replace(/\s+(style|class)\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/gi,"")),t+r+i):""})),e=e.replace(/<\/(strong|b|u|strike|em|i)>((?:\s|<br\/?>|&nbsp;)*?)<\1(\s+[^>]*?)?>/gi,"$2")},this.formatXHTML=function(e,t){function n(e){for(var t={},n=e.split(","),r=0;r<n.length;r++)t[n[r]]=!0;return t}function r(e){e=e.toLowerCase();var t=y[e];return t?t:e}function i(e,t,n){if(p[e])for(;S.last()&&d[S.last()];)s(S.last());v[e]&&S.last()===e&&s(e),n=h[e]||!!n,n||S.push(e);var r=Array();r.push("<"+e),t.replace(w,function(e,t){t=t.toLowerCase();var n=arguments[2]?arguments[2]:arguments[3]?arguments[3]:arguments[4]?arguments[4]:m[t]?t:"";r.push(" "+t+'="'+n.replace(/"/g,"'")+'"')}),r.push((n?" /":"")+">"),f(r.join(""),e,!0),"pre"===e&&(D=!0)}function s(e){if(e)for(var t=S.length-1;t>=0&&S[t]!==e;t--);else var t=0;if(t>=0){for(var n=S.length-1;n>=t;n--)f("</"+S[n]+">",S[n]);S.length=t}"pre"===e&&(D=!1,M--)}function o(e){f(_this.domEncode(e))}function u(e){E.push(e.replace(/^[\s\r\n]+|[\s\r\n]+$/g,""))}function a(e){E.push(e)}function f(e,n,r){if(D||(e=e.replace(/(\t*\r?\n\t*)+/g,"")),D||t!==!0)E.push(e);else{if(e.match(/^\s*$/))return void E.push(e);var i=p[n],s=i?n:"";i?(r&&M++,""===_&&M--):_&&M++,(s!==_||i)&&l(),E.push(e),"br"===n&&l(),!i||!h[n]&&r||M--,_=i?n:"",A=r}}function l(){if(E.push("\r\n"),M>0)for(var e=M;e--;)E.push("	")}function c(e,t,n,r){if(!n)return r;var i="";return n=n.replace(/ face\s*=\s*"\s*([^"]*)\s*"/i,function(e,t){return t&&(i+="font-family:"+t+";"),""}),n=n.replace(/ size\s*=\s*"\s*(\d+)\s*"/i,function(e,t){return i+="font-size:"+P[(t>7?7:1>t?1:t)-1].s+";",""}),n=n.replace(/ color\s*=\s*"\s*([^"]*)\s*"/i,function(e,t){return t&&(i+="color:"+t+";"),""}),n=n.replace(/ style\s*=\s*"\s*([^"]*)\s*"/i,function(e,t){return t&&(i+=t),""}),n+=' style="'+i+'"',n?"<span"+n+">"+r+"</span>":r}var h=n("area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed"),p=n("address,applet,blockquote,button,center,dd,dir,div,dl,dt,fieldset,form,frameset,h1,h2,h3,h4,h5,h6,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,p,pre,table,tbody,td,tfoot,th,thead,tr,ul,script"),d=n("a,abbr,acronym,applet,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,textarea,tt,u,var"),v=n("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr"),m=n("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),g=n("script,style"),y={b:"strong",i:"em",s:"del",strike:"del"},b=/<(?:\/([^\s>]+)|!([^>]*?)|([\w\-:]+)((?:"[^"]*"|'[^']*'|[^"'<>])*)\s*(\/?))>/g,w=/\s*([\w\-:]+)(?:\s*=\s*(?:"([^"]*)"|'([^']*)'|([^\s]+)))?/g,E=[],S=[];S.last=function(){return this[this.length-1]};for(var x,T,N,C,k,L,A,O=0,M=-1,_="body",D=!1;x=b.exec(e);)T=x.index,T>O&&(L=e.substring(O,T),C?k.push(L):o(L)),O=b.lastIndex,!(N=x[1])||(N=r(N),C&&N===C&&(u(k.join("")),C=null,k=null),C)?C?k.push(x[0]):(N=x[3])?(N=r(N),i(N,x[4],x[5]),g[N]&&(C=N,k=[])):x[2]&&a(x[0]):s(N);e.length>O&&o(e.substring(O,e.length)),s(),e=E.join(""),E=null;var P=settings.listFontsize;return e=e.replace(/<(font)(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/gi,c),e=e.replace(/<(font)(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?)<\/\1>/gi,c),e=e.replace(/<(font)(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S])*?)<\/\1>/gi,c),e=e.replace(/^(\s*\r?\n)+|(\s*\r?\n)+$/g,"")},this.toggleShowBlocktag=function(e){if(bShowBlocktag!==e){bShowBlocktag=!bShowBlocktag;var t=$(_doc.body);bShowBlocktag?(bodyClass+=" showBlocktag",t.addClass("showBlocktag")):(bodyClass=bodyClass.replace(" showBlocktag",""),t.removeClass("showBlocktag"))}},this.toggleSource=function(e){if(bSource!==e){_jTools.find("[cmd=Source]").toggleClass("xheEnabled").toggleClass("xheActive");var t,n,r=_doc.body,i=$(r),s='<span id="_xhe_cursor"></span>',o=0,u="";if(bSource?(t=_this.getSource(),i.html("").removeAttr("scroll").attr("class","editMode"+bodyClass),isIE?r.contentEditable="true":_doc.designMode="On",isMozilla&&(_this._exec("inserthtml","-"),$("#"+idFixFFCursor).show().focus().hide()),u="Source"):(_this.pasteHTML(s,!0),t=_this.getSource(!0),o=t.indexOf(s),isOpera||(o=t.substring(0,o).replace(/\r/g,"").length),t=t.replace(/(\r?\n\s*|)<span id="_xhe_cursor"><\/span>(\s*\r?\n|)/,function(e,t,n){return t&&n?"\r\n":t+n}),isIE?r.contentEditable="false":_doc.designMode="Off",i.attr("scroll","no").attr("class","sourceMode").html('<textarea id="sourceCode" wrap="soft" spellcheck="false" style="width:100%;height:100%" />'),n=$("#sourceCode",i).blur(_this.getSource)[0],u="WYSIWYG"),bSource=!bSource,_this.setSource(t),_this.focus(),bSource)if(n.setSelectionRange)n.setSelectionRange(o,o);else{var a=n.createTextRange();a.move("character",o),a.select()}else _this.setTextCursor();_jTools.find("[cmd=Source]").attr("title",getLang(u)).find("span").text(u),_jTools.find("[cmd=Source],[cmd=Preview]").toggleClass("xheEnabled"),_jTools.find(".xheButton").not("[cmd=Source],[cmd=Fullscreen],[cmd=About]").toggleClass("xheEnabled").attr("aria-disabled",bSource?!0:!1),setTimeout(setOpts,300)}},this.showPreview=function(){var e=settings.beforeSetSource,t=_this.getSource();e&&(t=e(t));var n="<html><head>"+headHTML+"<title>{#Preview}</title>"+(urlBase?'<base href="'+urlBase+'"/>':"")+"</head><body>"+t+"</body></html>",r=window.screen,i=window.open("","xhePreview","toolbar=yes,location=no,status=yes,menubar=yes,scrollbars=yes,resizable=yes,width="+Math.round(.9*r.width)+",height="+Math.round(.8*r.height)+",left="+Math.round(.05*r.width)),s=i.document;s.open(),s.write(getLang(n)),s.close(),i.focus()},this.toggleFullscreen=function(e){if(bFullscreen!==e){var t=$("#"+idContainer).find(".xheLayout"),n=$("#"+idContainer),r=jQuery.browser.version,i=isIE&&(6==r||7==r);bFullscreen?(i&&_jText.after(n),t.attr("style",sLayoutStyle),_jArea.height(editorHeight-_jTools.outerHeight()),$(window).scrollTop(outerScroll),setTimeout(function(){$(window).scrollTop(outerScroll)},10)):(i&&$("body").append(n),outerScroll=$(window).scrollTop(),sLayoutStyle=t.attr("style"),t.removeAttr("style"),_jArea.height("100%"),setTimeout(fixFullHeight,100)),isMozilla?($("#"+idFixFFCursor).show().focus().hide(),setTimeout(_this.focus,1)):i&&_this.setTextCursor(),bFullscreen=!bFullscreen,n.toggleClass("xhe_Fullscreen"),$("html").toggleClass("xhe_Fullfix"),_jTools.find("[cmd=Fullscreen]").toggleClass("xheActive"),setTimeout(setOpts,300)}},this.showMenu=function(e,t){var n=$('<div class="xheMenu"></div>'),r=e.length,i=[];$.each(e,function(e,t){i.push("-"===t.s?'<div class="xheMenuSeparator"></div>':"<a href=\"javascript:void('"+t.v+'\')" title="'+(t.t?t.t:t.s)+'" v="'+t.v+'" role="option" aria-setsize="'+r+'" aria-posinset="'+(e+1)+'" tabindex="0">'+t.s+"</a>")}),n.append(getLang(i.join(""))),n.click(function(e){return e=e.target,$.nodeName(e,"DIV")?void 0:(_this.loadBookmark(),t($(e).closest("a").attr("v")),_this.hidePanel(),!1)}).mousedown(returnFalse),_this.saveBookmark(),_this.showPanel(n)},this.showColor=function(e){var t=settings.listColors,n=$('<div class="xheColor"></div>'),r=[],i=t.length,s=0;$.each(t,function(e,t){s%7===0&&r.push((s>0?"</div>":"")+"<div>"),r.push("<a href=\"javascript:void('"+t+'\')" xhev="'+t+'" title="'+t+'" style="background:'+t+'" role="option" aria-setsize="'+i+'" aria-posinset="'+(s+1)+'"></a>'),s++}),r.push("</div>"),n.append(r.join("")),n.click(function(t){return t=t.target,$.nodeName(t,"A")?(_this.loadBookmark(),e($(t).attr("xhev")),_this.hidePanel(),!1):void 0}).mousedown(returnFalse),_this.saveBookmark(),_this.showPanel(n)},this.showPastetext=function(){var e=$(getLang(htmlPastetext)),t=$("#xhePastetextValue",e),n=$("#xheSave",e);n.click(function(){_this.loadBookmark();var e=t.val();return e&&_this.pasteText(e),_this.hidePanel(),!1}),_this.saveBookmark(),_this.showDialog(e)},this.showLink=function(){var e=htmlLink,t=_jDoc.find("a[name]").not("[href]"),n=t.length>0;if(n){var r=[];t.each(function(){var e=$(this).attr("name");r.push('<option value="#'+e+'">'+e+"</option>")}),e=e.replace(/(<div><label for="xheLinkTarget)/,'<div><label for="xheLinkAnchor">{#link.anchor}</label><select id="xheLinkAnchor"><option value="">{#link.anchorNone}</option>'+r.join("")+"</select></div>$1")}var i=$(getLang(e)),s=_this.getParent("a"),o=$("#xheLinkText",i),u=$("#xheLinkUrl",i),a=$("#xheLinkTarget",i),f=$("#xheSave",i),l=_this.getSelect();if(n&&i.find("#xheLinkAnchor").change(function(){var e=$(this).val();""!=e&&u.val(e)}),1===s.length){if(!s.attr("href"))return ev=null,_this.exec("Anchor");u.val(xheAttr(s,"href")),a.attr("value",s.attr("target"))}else""===l&&o.val(getLang(settings.defLinkText)).closest("div").show();settings.upLinkUrl&&_this.uploadInit(u,settings.upLinkUrl,settings.upLinkExt),f.click(function(){_this.loadBookmark();var e=u.val();if((""===e||0===s.length)&&_this._exec("unlink"),""!==e&&"http://"!==e){var t=e.split(" "),n=a.val(),r=o.val();if(t.length>1){_this._exec("unlink"),l=_this.getSelect();var i,f='<a href="xhe_tmpurl"',c=[];""!==n&&(f+=' target="'+n+'"'),f+=">xhe_tmptext</a>",r=""!==l?l:r?r:e;for(var p=0,d=t.length;d>p;p++)e=t[p],""!==e&&(e=e.split("||"),i=f,i=i.replace("xhe_tmpurl",e[0]),i=i.replace("xhe_tmptext",e[1]?e[1]:r),c.push(i));_this.pasteHTML(c.join("&nbsp;"))}else e=t[0].split("||"),r||(r=e[0]),r=e[1]?e[1]:""!==l?"":r?r:e[0],0===s.length?(r?_this.pasteHTML('<a href="#xhe_tmpurl">'+r+"</a>"):_this._exec("createlink","#xhe_tmpurl"),s=$('a[href$="#xhe_tmpurl"]',_doc)):r&&!isWebkit&&s.text(r),xheAttr(s,"href",e[0]),""!==n?s.attr("target",n):s.removeAttr("target")}return _this.hidePanel(),!1}),_this.saveBookmark(),_this.showDialog(i)},this.showAnchor=function(){var e=$(getLang(htmlAnchor)),t=_this.getParent("a"),n=$("#xheAnchorName",e),r=$("#xheSave",e);if(1===t.length){if(t.attr("href"))return ev=null,_this.exec("Link");n.val(t.attr("name"))}r.click(function(){_this.loadBookmark();var e=n.val();return e?0===t.length?_this.pasteHTML('<a name="'+e+'"></a>'):t.attr("name",e):1===t.length&&t.remove(),_this.hidePanel(),!1}),_this.saveBookmark(),_this.showDialog(e)},this.showImg=function(){var e=$(getLang(htmlImg)),t=_this.getParent("img"),n=$("#xheImgUrl",e),r=$("#xheImgAlt",e),i=$("#xheImgAlign",e),s=$("#xheImgWidth",e),o=$("#xheImgHeight",e),u=$("#xheImgBorder",e),a=$("#xheImgVspace",e),f=$("#xheImgHspace",e),l=$("#xheSave",e);if(1===t.length){n.val(xheAttr(t,"src")),r.val(t.attr("alt")),i.val(t.attr("align")),s.val(t.attr("width")),o.val(t.attr("height")),u.val(t.attr("border"));var c=t.attr("vspace"),h=t.attr("hspace");a.val(0>=c?"":c),f.val(0>=h?"":h)}settings.upImgUrl&&_this.uploadInit(n,settings.upImgUrl,settings.upImgExt),l.click(function(){_this.loadBookmark();var e=n.val();if(""!==e&&"http://"!==e){var l=e.split(" "),c=r.val(),h=i.val(),p=s.val(),v=o.val(),m=u.val(),y=a.val(),w=f.val();if(l.length>1){var E,S='<img src="xhe_tmpurl"',x=[];""!==c&&(S+=' alt="'+c+'"'),""!==h&&(S+=' align="'+h+'"'),""!==p&&(S+=' width="'+p+'"'),""!==v&&(S+=' height="'+v+'"'),""!==m&&(S+=' border="'+m+'"'),""!==y&&(S+=' vspace="'+y+'"'),""!==w&&(S+=' hspace="'+w+'"'),S+=" />";for(var T in l)e=l[T],""!==e&&(e=e.split("||"),E=S,E=E.replace("xhe_tmpurl",e[0]),e[1]&&(E='<a href="'+e[1]+'" target="_blank">'+E+"</a>"),x.push(E));_this.pasteHTML(x.join("&nbsp;"))}else if(1===l.length&&(e=l[0],""!==e&&(e=e.split("||"),0===t.length&&(_this.pasteHTML('<img src="'+e[0]+'#xhe_tmpurl" />'),t=$('img[src$="#xhe_tmpurl"]',_doc)),xheAttr(t,"src",e[0]),""!==c&&t.attr("alt",c),""!==h?t.attr("align",h):t.removeAttr("align"),""!==p?t.attr("width",p):t.removeAttr("width"),""!==v?t.attr("height",v):t.removeAttr("height"),""!==m?t.attr("border",m):t.removeAttr("border"),""!==y?t.attr("vspace",y):t.removeAttr("vspace"),""!==w?t.attr("hspace",w):t.removeAttr("hspace"),e[1]))){var N=t.parent("a");0===N.length&&(t.wrap("<a></a>"),N=t.parent("a")),xheAttr(N,"href",e[1]),N.attr("target","_blank")}}else 1===t.length&&t.remove();return _this.hidePanel(),!1}),_this.saveBookmark(),_this.showDialog(e)},this.showEmbed=function(e,t,n,r,i,s,o){var u=$(getLang(t)),a=_this.getParent('embed[type="'+n+'"],embed[classid="'+r+'"]'),f=$("#xhe"+e+"Url",u),l=$("#xhe"+e+"Width",u),c=$("#xhe"+e+"Height",u),h=$("#xheSave",u);s&&_this.uploadInit(f,s,o),1===a.length&&(f.val(xheAttr(a,"src")),l.val(a.attr("width")),c.val(a.attr("height"))),h.click(function(){_this.loadBookmark();var e=f.val();if(""!==e&&"http://"!==e){var t=l.val(),s=c.val(),o=/^\d+%?$/;o.test(t)||(t=412),o.test(s)||(s=300);var u='<embed type="'+n+'" classid="'+r+'" src="xhe_tmpurl"'+i,h=e.split(" ");if(h.length>1){var p,v=u+"",m=[];v+=' width="xhe_width" height="xhe_height" />';for(var g in h)e=h[g].split("||"),p=v,p=p.replace("xhe_tmpurl",e[0]),p=p.replace("xhe_width",e[1]?e[1]:t),p=p.replace("xhe_height",e[2]?e[2]:s),""!==e&&m.push(p);_this.pasteHTML(m.join("&nbsp;"))}else 1===h.length&&(e=h[0].split("||"),0===a.length&&(_this.pasteHTML(u.replace("xhe_tmpurl",e[0]+"#xhe_tmpurl")+" />"),a=$('embed[src$="#xhe_tmpurl"]',_doc)),xheAttr(a,"src",e[0]),a.attr("width",e[1]?e[1]:t),a.attr("height",e[2]?e[2]:s))}else 1===a.length&&a.remove();return _this.hidePanel(),!1}),_this.saveBookmark(),_this.showDialog(u)},this.showEmot=function(e){var t=$('<div class="xheEmot"></div>');e=e?e:selEmotGroup?selEmotGroup:"default";var n=arrEmots[e],r=emotPath+e+"/",i=0,s=[],o="",u=n.width,a=n.height,f=n.line,l=n.count,c=n.list;if(l)for(var h=1;l>=h;h++)i++,s.push("<a href=\"javascript:void('"+h+'\')" style="background-image:url('+r+h+'.gif);" emot="'+e+","+h+'" xhev="" title="'+h+'" role="option">&nbsp;</a>'),i%f===0&&s.push("<br />");else{var p=is(c,"array");$.each(c,function(t,n){p&&(t=n,n="{#emot."+e+"."+t+"}"),i++,s.push("<a href=\"javascript:void('"+n+'\')" style="background-image:url('+r+t+'.gif);" emot="'+e+","+t+'" title="'+n+'" xhev="'+n+'" role="option">&nbsp;</a>'),i%f===0&&s.push("<br />")})}var d=f*(u+12),v=Math.ceil(i/f)*(a+12),m=.75*d;m>=v&&(m=""),o=$(getLang("<style>"+(m?".xheEmot div{width:"+(d+20)+"px;height:"+m+"px;}":"")+".xheEmot div a{width:"+u+"px;height:"+a+"px;}</style><div>"+s.join("")+"</div>")).click(function(e){e=e.target;var t=$(e);if($.nodeName(e,"A"))return _this.loadBookmark(),_this.pasteHTML('<img emot="'+t.attr("emot")+'" alt="'+t.attr("xhev")+'">'),_this.hidePanel(),!1}).mousedown(returnFalse),t.append(o);var g,y=0,b=['<ul role="tablist">'];$.each(arrEmots,function(t,n){y++,b.push("<li"+(e===t?' class="cur"':"")+' role="presentation"><a href="javascript:void(\''+n.name+'\')" group="'+t+'" role="tab" tabindex="0">'+n.name+"</a></li>")}),y>1&&(b.push('</ul><br style="clear:both;" />'),g=$(getLang(b.join(""))).click(function(e){return selEmotGroup=$(e.target).attr("group"),_this.exec("Emot"),!1}).mousedown(returnFalse),t.append(g)),_this.saveBookmark(),_this.showPanel(t)},this.showTable=function(){var e=$(getLang(htmlTable)),t=$("#xheTableRows",e),n=$("#xheTableColumns",e),r=$("#xheTableHeaders",e),i=$("#xheTableWidth",e),s=$("#xheTableHeight",e),o=$("#xheTableBorder",e),u=$("#xheTableCellSpacing",e),a=$("#xheTableCellPadding",e),f=$("#xheTableAlign",e),l=$("#xheTableCaption",e),c=$("#xheSave",e);c.click(function(){_this.loadBookmark();var e,c,p=l.val(),v=o.val(),m=t.val(),y=n.val(),w=r.val(),E=i.val(),S=s.val(),x=u.val(),T=a.val(),N=f.val(),C="<table"+(""!==v?' border="'+v+'"':"")+(""!==E?' width="'+E+'"':"")+(""!==S?' height="'+S+'"':"")+(""!==x?' cellspacing="'+x+'"':"")+(""!==T?' cellpadding="'+T+'"':"")+(""!==N?' align="'+N+'"':"")+">";if(""!==p&&(C+="<caption>"+p+"</caption>"),"row"===w||"both"===w){for(C+="<tr>",e=0;y>e;e++)C+='<th scope="col"></th>';C+="</tr>",m--}for(C+="<tbody>",e=0;m>e;e++){for(C+="<tr>",c=0;y>c;c++)C+=0!==c||"col"!==w&&"both"!==w?"<td></td>":'<th scope="row"></th>';C+="</tr>"}return C+="</tbody></table>",_this.pasteHTML(C),_this.hidePanel(),!1}),_this.saveBookmark(),_this.showDialog(e)},this.showAbout=function(){var e=$(getLang(htmlAbout));e.find("p").attr("role","presentation"),_this.showDialog(e,!0),setTimeout(function(){e.focus()},100)},this.addShortcuts=function(e,t){e=e.toLowerCase(),arrShortCuts[e]===undefined&&(arrShortCuts[e]=Array()),arrShortCuts[e].push(t)},this.delShortcuts=function(e){delete arrShortCuts[e]},this.uploadInit=function(e,t,n){function r(t){is(t,"string")&&(t=[t]);var n,r,i,s=!1,o=t.length,u=[],a=settings.onUpload;for(a&&a(t),n=0;o>n;n++)r=t[n],i=is(r,"string")?r:r.url,"!"===i.substr(0,1)&&(s=!0,i=i.substr(1)),u.push(i);e.val(u.join(" ")),s&&e.closest(".xheDialog").find("#xheSave").click()}var i=$(getLang('<span class="xheUpload"><input type="text" style="visibility:hidden;" tabindex="-1" /><input type="button" value="'+settings.upBtnText+'" class="xheBtn" tabindex="-1" /></span>')),s=$(".xheBtn",i),o=settings.html5Upload,u=o?settings.upMultiple:1;if(e.after(i),s.before(e),t=t.replace(/{editorRoot}/gi,editorRoot),"!"===t.substr(0,1))s.click(function(){_this.showIframeModal("{#upload.browserTitle}",t.substr(1),r,null,null)});else{i.append('<input type="file"'+(u>1?' multiple=""':"")+' class="xheFile" size="13" name="'+uploadInputname+'" tabindex="-1" />');var a,f=$(".xheFile",i);f.change(function(){a=[],_this.startUpload(f[0],t,n,r)}),setTimeout(function(){e.closest(".xheDialog").bind("dragenter dragover",returnFalse).bind("drop",function(e){var i,s=e.originalEvent.dataTransfer;return o&&s&&(i=s.files)&&i.length>0&&_this.startUpload(i,t,n,r),!1})},10)}},this.startUpload=function(fromFiles,toUrl,limitExt,onUploadComplete){function onUploadCallback(sText,bFinish){var data=Object,bOK=!1;try{data=eval("("+sText+")")}catch(ex){}return data.err===undefined||data.msg===undefined?alert(getLang("upload.apiError",toUrl,sText)):data.err?alert(data.err):(arrMsg.push(data.msg),bOK=!0),(!bOK||bFinish)&&_this.removeModal(),bFinish&&bOK&&onUploadComplete(arrMsg),bOK}var arrMsg=[],bHtml5Upload=settings.html5Upload,upMultiple=bHtml5Upload?settings.upMultiple:1,upload,fileList,filename,jUploadTip=$(getLang('<div style="padding:22px 0;text-align:center;line-height:30px;">{#upload.progressTip}<br /></div>')),sLoading='<img src="'+skinPath+'img/loading.gif">';if(!isOpera&&bHtml5Upload&&(!fromFiles.nodeType||(fileList=fromFiles.files)&&fileList[0].name)){fileList||(fileList=fromFiles);var i,len=fileList.length;if(len>upMultiple)return void alert(getLang("upload.countLimit",upMultiple));for(i=0;len>i;i++)if(!checkFileExt(fileList[i].name,limitExt))return;var jProgress=$('<div class="xheProgress"><div><span>0%</span></div></div>');jUploadTip.append(jProgress),upload=new _this.html5Upload(uploadInputname,fileList,toUrl,onUploadCallback,function(e){if(e.loaded>=0){var t=Math.round(100*e.loaded/e.total)+"%";$("div",jProgress).css("width",t),$("span",jProgress).text(t+" ( "+formatBytes(e.loaded)+" / "+formatBytes(e.total)+" )")}else jProgress.replaceWith(sLoading)})}else{if(!checkFileExt(fromFiles.value,limitExt))return;jUploadTip.append(sLoading),upload=new _this.html4Upload(fromFiles,toUrl,onUploadCallback)}_this.showModal("{#upload.progressTitle}",jUploadTip,320,150),upload.start()},this.html4Upload=function(e,t,n){var r=(new Date).getTime(),i="jUploadFrame"+r,s=this,o=$('<iframe name="'+i+'" class="xheHideArea" />').appendTo("body"),u=$('<form action="'+t+'" target="'+i+'" method="post" enctype="multipart/form-data" class="xheHideArea"></form>').appendTo("body"),a=$(e),f=a.clone().attr("disabled","true");return a.before(f).appendTo(u),this.remove=function(){null!==s&&(f.before(a).remove(),o.remove(),u.remove(),s=null)},this.onLoad=function(){var e=o[0].contentWindow.document,t=$(e.body).text();e.write(""),s.remove(),n(t,!0)},this.start=function(){u.submit(),o.load(s.onLoad)},this},this.html5Upload=function(e,t,n,r,i){function s(t,n,r,i){u=new XMLHttpRequest,upload=u.upload,u.onreadystatechange=function(){4===u.readyState&&r(u.responseText)},upload?upload.onprogress=function(e){i(e.loaded)}:i(-1),u.open("POST",n),u.setRequestHeader("Content-Type","application/octet-stream"),u.setRequestHeader("Content-Disposition",'attachment; name="'+encodeURIComponent(e)+'"; filename="'+encodeURIComponent(t.name)+'"'),u.sendAsBinary&&t.getAsBinary?u.sendAsBinary(t.getAsBinary()):u.send(t)}function o(e){i&&i({loaded:l+e,total:c})}for(var u,a=0,f=t.length,l=0,c=0,h=this,p=0;f>p;p++)c+=t[p].size;this.remove=function(){u&&(u.abort(),u=null)},this.uploadNext=function(e){e&&(l+=t[a-1].size,o(0)),(!e||e&&r(e,a===f)===!0)&&f>a&&s(t[a++],n,h.uploadNext,function(e){o(e)})},this.start=function(){h.uploadNext()}},this.showIframeModal=function(title,url,callback,w,h,onRemove){function initModalWin(){try{modalWin.callback=callbackModal,modalWin.unloadme=_this.removeModal,$(modalWin.document).keydown(checkEsc),result=modalWin.name}catch(e){}}function callbackModal(e){modalWin.document.write(""),_this.removeModal(),null!=e&&callback(e)}var jContent=$('<iframe frameborder="0" src="'+url.replace(/{editorRoot}/gi,editorRoot)+(/\?/.test(url)?"&":"?")+"parenthost="+location.host+'" style="width:100%;height:100%;display:none;" /><div class="xheModalIfmWait"></div>'),jIframe=jContent.eq(0),jWait=jContent.eq(1);_this.showModal(title,jContent,w,h,onRemove);var modalWin=jIframe[0].contentWindow,result;initModalWin(),jIframe.load(function(){if(initModalWin(),result){var bResult=!0;try{result=eval("("+unescape(result)+")")}catch(e){bResult=!1}if(bResult)return callbackModal(result)}jWait.is(":visible")&&(jIframe.show().focus(),jWait.remove())})},this.showModal=function(e,t,n,r,i){return bShowModal?!1:(_this.panelState=bShowPanel,bShowPanel=!1,layerShadow=settings.layerShadow,n=n?n:settings.modalWidth,r=r?r:settings.modalHeight,jModal=$(getLang('<div class="xheModal" style="width:'+(n-1)+"px;height:"+r+"px;margin-left:-"+Math.ceil(n/2)+"px;"+(isIE&&7>browerVer?"":"margin-top:-"+Math.ceil(r/2)+"px")+'">'+(settings.modalTitle?'<div class="xheModalTitle"><span class="xheModalClose" title="{#close} (Esc)" tabindex="0" role="button"></span>'+e+"</div>":"")+'<div class="xheModalContent"></div></div>')).appendTo("body"),jOverlay=$('<div class="xheModalOverlay"></div>').appendTo("body"),layerShadow>0&&(jModalShadow=$('<div class="xheModalShadow" style="width:'+jModal.outerWidth()+"px;height:"+jModal.outerHeight()+"px;margin-left:-"+(Math.ceil(n/2)-layerShadow-2)+"px;"+(isIE&&7>browerVer?"":"margin-top:-"+(Math.ceil(r/2)-layerShadow-2)+"px")+'"></div>').appendTo("body")),$(".xheModalContent",jModal).css("height",r-(settings.modalTitle?$(".xheModalTitle").outerHeight():0)).html(t),isIE&&6===browerVer&&(jHideSelect=$("select:visible").css("visibility","hidden")),$(".xheModalClose",jModal).click(_this.removeModal),jOverlay.show(),layerShadow>0&&jModalShadow.show(),jModal.show(),setTimeout(function(){jModal.find("a,input[type=text],textarea").filter(":visible").filter(function(){return"hidden"!==$(this).css("visibility")}).eq(0).focus()},10),bShowModal=!0,void (onModalRemove=i))},this.removeModal=function(){jHideSelect&&jHideSelect.css("visibility","visible"),jModal.html("").remove(),layerShadow>0&&jModalShadow.remove(),jOverlay.remove(),onModalRemove&&onModalRemove(),bShowModal=!1,bShowPanel=_this.panelState},this.showDialog=function(e,t){var n=$('<div class="xheDialog"></div>'),r=$(e),i=$("#xheSave",r);if(1===i.length){if(r.find("input[type=text],select").keypress(function(e){return 13===e.which?(i.click(),!1):void 0}),r.find("textarea").keydown(function(e){return e.ctrlKey&&13===e.which?(i.click(),!1):void 0}),i.after(getLang(' <input type="button" id="xheCancel" value="{#dialogCancel}" />')),$("#xheCancel",r).click(_this.hidePanel),!settings.clickCancelDialog){bClickCancel=!1;var s=$('<div class="xheFixCancel"></div>').appendTo("body").mousedown(returnFalse),o=_jArea.offset();s.css({left:o.left,top:o.top,width:_jArea.outerWidth(),height:_jArea.outerHeight()})}n.mousedown(function(){bDisableHoverExec=!0})}n.append(r),_this.showPanel(n,t)},this.showPanel=function(e,t){if(!ev.target)return!1;_jPanel.html("").append(e).css("left",-999).css("top",-999),_jPanelButton=$(ev.target).closest("a").addClass("xheActive");var n=_jPanelButton.offset(),r=n.left,i=n.top;i+=_jPanelButton.outerHeight()-1,_jCntLine.css({left:r+1,top:i,width:_jPanelButton.width()}).show();var s=document.documentElement,o=document.body;r+_jPanel.outerWidth()>(window.pageXOffset||s.scrollLeft||o.scrollLeft)+(s.clientWidth||o.clientWidth)&&(r-=_jPanel.outerWidth()-_jPanelButton.outerWidth());var u=settings.layerShadow;u>0&&_jShadow.css({left:r+u,top:i+u,width:_jPanel.outerWidth(),height:_jPanel.outerHeight()}).show();var a=$("#"+idContainer).offsetParent().css("zIndex");a&&!isNaN(a)&&(_jShadow.css("zIndex",parseInt(a,10)+1),_jPanel.css("zIndex",parseInt(a,10)+2),_jCntLine.css("zIndex",parseInt(a,10)+3)),_jPanel.css({left:r,top:i}).show(),t||setTimeout(function(){_jPanel.find("a,input[type=text],textarea").filter(":visible").filter(function(){return"hidden"!==$(this).css("visibility")}).eq(0).focus()},10),bQuickHoverExec=bShowPanel=!0},this.hidePanel=function(){bShowPanel&&(_jPanelButton.removeClass("xheActive"),_jShadow.hide(),_jCntLine.hide(),_jPanel.hide(),bShowPanel=!1,bClickCancel||($(".xheFixCancel").remove(),bClickCancel=!0),bQuickHoverExec=bDisableHoverExec=!1,lastAngle=null,_this.focus(),_this.loadBookmark())},this.exec=function(e){_this.hidePanel();var t=arrTools[e];if(!t)return!1;if(null===ev){ev={};var n=_jTools.find(".xheButton[cmd="+e+"]");1===n.length&&(ev.target=n)}if(t.e)t.e.call(_this);else switch(e=e.toLowerCase()){case"cut":try{if(_doc.execCommand(e),!_doc.queryCommandSupported(e))throw"Error"}catch(r){alert(getLang("cutDisabledTip"))}break;case"copy":try{if(_doc.execCommand(e),!_doc.queryCommandSupported(e))throw"Error"}catch(r){alert(getLang("copyDisabledTip"))}break;case"paste":try{if(_doc.execCommand(e),!_doc.queryCommandSupported(e))throw"Error"}catch(r){alert(getLang("pasteDisabledTip"))}break;case"pastetext":window.clipboardData?_this.pasteText(window.clipboardData.getData("Text",!0)):_this.showPastetext();break;case"blocktag":var i=[];$.each(settings.listBlocktag,function(e,t){i.push({s:"<"+t.n+">{#listBlocktag."+t.n+"}</"+t.n+">",v:"<"+t.n+">",t:"{#listBlocktag."+t.n+"}"})}),_this.showMenu(i,function(e){_this._exec("formatblock",e)});break;case"fontface":var s=[];$.each(getLang("listFontname"),function(e,t){t.c=t.c?t.c:t.n,s.push({s:'<span style="font-family:'+t.c+'">'+t.n+"</span>",v:t.c,t:t.n})}),_this.showMenu(s,function(e){_this._exec("fontname",e)});break;case"fontsize":var o=[];$.each(settings.listFontsize,function(e,t){o.push({s:'<span style="font-size:'+t.s+';">{#fontsize.'+t.n+"}("+t.s+")</span>",v:e+1,t:"{#fontsize."+t.n+"}"})}),_this.showMenu(o,function(e){_this._exec("fontsize",e)});break;case"fontcolor":_this.showColor(function(e){_this._exec("forecolor",e)});break;case"backcolor":_this.showColor(function(e){isIE?_this._exec("backcolor",e):(setCSS(!0),_this._exec("hilitecolor",e),setCSS(!1))});break;case"align":var u=[];$.each(arrAlign,function(e,t){u.push({s:"{#align."+t.v+"}",v:t.v})}),_this.showMenu(u,function(e){_this._exec(e)});break;case"list":var a=[];$.each(arrList,function(e,t){a.push({s:"{#list."+t.v+"}",v:t.v})}),_this.showMenu(a,function(e){_this._exec(e)});break;case"link":_this.showLink();break;case"anchor":_this.showAnchor();break;case"img":_this.showImg();break;case"flash":_this.showEmbed("Flash",htmlFlash,"application/x-shockwave-flash","clsid:d27cdb6e-ae6d-11cf-96b8-4445535400000",' wmode="opaque" quality="high" menu="false" play="true" loop="true" allowfullscreen="true"',settings.upFlashUrl,settings.upFlashExt);break;case"media":_this.showEmbed("Media",htmlMedia,"application/x-mplayer2","clsid:6bf52a52-394a-11d3-b153-00c04f79faa6",' enablecontextmenu="false" autostart="false"',settings.upMediaUrl,settings.upMediaExt);break;case"hr":_this.pasteHTML("<hr />");break;case"emot":_this.showEmot();break;case"table":_this.showTable();break;case"source":_this.toggleSource();break;case"preview":_this.showPreview();break;case"print":_win.print();break;case"fullscreen":_this.toggleFullscreen();break;case"about":_this.showAbout();break;default:_this._exec(e)}ev=null},this._exec=function(e,t,n){n||_this.focus();var r;return r=t!==undefined?_doc.execCommand(e,!1,t):_doc.execCommand(e,!1,null)}};XHEDITOR.settings={skin:"default",tools:"full",clickCancelDialog:!0,linkTag:!1,internalScript:!1,inlineScript:!1,internalStyle:!0,inlineStyle:!0,showBlocktag:!1,forcePtag:!0,upLinkExt:"zip,rar,txt",upImgExt:"jpg,jpeg,gif,png",upFlashExt:"swf",upMediaExt:"wmv,avi,wma,mp3,mid",modalWidth:350,modalHeight:220,modalTitle:!0,defLinkText:"{#link.defText}",layerShadow:3,emotMark:!1,upBtnText:"{#upload.btnText}",cleanPaste:1,hoverExecDelay:100,html5Upload:!0,upMultiple:99,listBlocktag:[{n:"p"},{n:"h1"},{n:"h2"},{n:"h3"},{n:"h4"},{n:"h5"},{n:"h6"},{n:"pre"},{n:"address"}],listColors:["#FFFFFF","#CCCCCC","#C0C0C0","#999999","#666666","#333333","#000000","#FFCCCC","#FF6666","#FF0000","#CC0000","#990000","#660000","#330000","#FFCC99","#FF9966","#FF9900","#FF6600","#CC6600","#993300","#663300","#FFFF99","#FFFF66","#FFCC66","#FFCC33","#CC9933","#996633","#663333","#FFFFCC","#FFFF33","#FFFF00","#FFCC00","#999900","#666600","#333300","#99FF99","#66FF99","#33FF33","#33CC00","#009900","#006600","#003300","#99FFFF","#33FFFF","#66CCCC","#00CCCC","#339999","#336666","#003333","#CCFFFF","#66FFFF","#33CCFF","#3366FF","#3333FF","#000099","#000066","#CCCCFF","#9999FF","#6666CC","#6633FF","#6600CC","#333399","#330099","#FFCCFF","#FF99FF","#CC66CC","#CC33CC","#993399","#663366","#330033"],listFontsize:[{n:"x-small",s:"10px"},{n:"small",s:"12px"},{n:"small2",s:"14px"},{n:"medium",s:"16px"},{n:"large",s:"18px"},{n:"x-large",s:"24px"},{n:"xx-large",s:"32px"},{n:"-webkit-xxx-large",s:"48px"}]},$.fn.xheditor=function(options){var editTest=document.body.contentEditable?document.body.contentEditable:document.designMode;if(!editTest)return!1;var arrSuccess=[];return this.each(function(){if($.nodeName(this,"TEXTAREA"))if(options===!1)this.xheditor&&(this.xheditor.remove(),this.xheditor=null);else if(this.xheditor)arrSuccess.push(this.xheditor);else{var tOptions=/({.*})/.exec($(this).attr("class"));if(tOptions){try{tOptions=eval("("+tOptions[1]+")")}catch(ex){}options=$.extend({},tOptions,options)}var editor=new Xheditor(this,options);editor.init()?(this.xheditor=editor,arrSuccess.push(editor)):editor=null}}),0===arrSuccess.length&&(arrSuccess=!1),1===arrSuccess.length&&(arrSuccess=arrSuccess[0]),arrSuccess},$.fn.oldVal=$.fn.val,$.fn.val=function(e){var t,n=this;return e===undefined?n[0]&&(t=n[0].xheditor)?t.getSource():n.oldVal():n.each(function(){(t=this.xheditor)?t.setSource(e):n.oldVal(e)})},$(function(){$("textarea").each(function(){var e=$(this),t=e.attr("class");t&&(t=t.match(/(?:^|\s)xheditor(?:\-(m?full|simple|mini))?(?:\s|$)/i))&&e.xheditor(t[1]?{tools:t[1]}:null)})})}(XHEDITOR,jQuery);