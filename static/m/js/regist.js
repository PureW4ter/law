define('regist',["ajaxhelper","utility","validate","component/time_button"],function(e,t,n,r){var i={user:null,initialize:function(){window.localStorage.removeItem("userInfo"),this.mainBox=$("#i_mainbox"),this.tplfun=_.template($("#i_tpl").html()),t.getQueryParameter("code")?this._sendRequest():this._createWXUser()},_sendRequest:function(){var n={code:t.getQueryParameter("code")};e.get("http://"+window.frontJSHost+"/user/wxlogin",n,this,this._render)},_createWXUser:function(){var e="https://open.weixin.qq.com/connect/oauth2/authorize?",n="http://wx.jf-zy.com/regist.html",r={};r.appid=t.appid,r.redirect_uri=encodeURIComponent(n),r.response_type="code",r.scope="snsapi_userinfo";for(var i in r)e+=i+"="+r[i]+"&";e=e.substr(0,e.length-1),window.location=e+"#wechat_redirect"},_render:function(e){this.user=e.r;if(!!this.user.phone){t.saveData("userInfo",JSON.stringify(this.user)),window.location="index.html";return}this.mainBox.html(this.tplfun()),r.initialize("i_getcode_btn"),this._registEvent()},_registEvent:function(){$("#i_regist_btn").off("click",this._bind).on("click",{ctx:this},this._bind),r.registBtnEvent(this.getCode)},getCode:function(){var i=$("#i_phone").val();if(!i){t.showToast("请先输入手机号码");return}if(!n.isMobile(i)){t.showToast("请输入正确的手机号码");return}var s={phoneNum:i};e.get("http://"+window.frontJSHost+"/ssm/code",s,this,function(){}),r.startCount()},_bind:function(n){if(!this.validate())return;var r={phone:$("#i_phone").val(),code:$("#i_input_code").val(),userId:n.data.ctx.user.id};e.get("http://"+window.frontJSHost+"/user/bind",r,this,function(e){t.saveData("userInfo",JSON.stringify(e.r)),window.location="index.html"})},validate:function(){var e=!0,r=$("#i_phone").val();if(!r)return t.showToast("手机号码不能为空"),e=!1,e;if(!n.isMobile(r))return t.showToast("请输入正确的手机号码"),e=!1,e;var i=$("#i_input_code").val();return i?e:(t.showToast("验证码不能为空"),e=!1,e)}};return i});